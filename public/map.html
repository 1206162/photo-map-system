<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>写真一覧とマップ表示</title>
  <style>
    body { 
    font-family: sans-serif; margin: 0; padding: 16px; background: #f5f5f5; 
    }
    #gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
    }
    .photo-thumb {
      width: 100%;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: opacity 0.3s;
      cursor: pointer;
    }
    .viewed {
      opacity: 0.5;
    }
     #map-view {
      display: none;
      text-align: center;
    }
    #map-view h3 {
      font-size: 18px;
      margin-bottom: 10px;
    }
    svg {
      width: 100%;
      max-width: 720px;
      height: auto;
      touch-action: manipulation;
    }
    .room {
      fill: transparent;
      stroke: transparent;
      stroke-width: 1;
    }
    .highlight { stroke: red; stroke-width: 4; fill: rgba(255,0,0,0.1); }
  </style>
</head>
<body>
  
  <div id="gallery"></div>

  <div id="map-view">
    <h3>該当する部屋</h3>
    <svg viewBox="0 0 720 1040" id="map-svg">
      <image href="map.png" x="0" y="0" width="720" height="1040" />
      <!-- 部屋枠 -->
      <rect id="room-402" class="room" x="430" y="0" width="130" height="250" />
      <rect id="room-403" class="room" x="415" y="390" width="145" height="115" />
      <rect id="room-404" class="room" x="415" y="505" width="145" height="115" />
      <rect id="room-405" class="room" x="415" y="620" width="145" height="115" />
      <rect id="room-406" class="room" x="415" y="735" width="145" height="115" />
      <rect id="room-407" class="room" x="150" y="851" width="140" height="77" />
      <rect id="room-408" class="room" x="150" y="774" width="212" height="77" />
      <rect id="room-409" class="room" x="150" y="697" width="212" height="77" />
      <rect id="room-410" class="room" x="150" y="620" width="212" height="77" />
      <rect id="room-411" class="room" x="150" y="423" width="142" height="113" />
      <rect id="room-412" class="room" x="150" y="310" width="140" height="113" />
      <rect id="room-413" class="room" x="150" y="80" width="210" height="170" />
    </svg>
       <p style="font-size: 14px; color: #888;">どこかをタップして戻る</p>
  </div>
 <script>
    const roomList = ['402','403','404','405','406','407','408','409','410','411','412','413'];
    const gallery = document.getElementById('gallery');
    const mapView = document.getElementById('map-view');
    const mapSvg = document.getElementById('map-svg');

    let viewedPhotos = new Set();

    async function loadPhotos() {
      const res = await fetch('/photos');
      const photos = await res.json();

      photos.forEach(photo => {
        const img = document.createElement('img');
        img.src = photo.url;
        img.className = 'photo-thumb';
        if (viewedPhotos.has(photo.id)) img.classList.add('viewed');

        img.addEventListener('click', () => {
          gallery.style.display = 'none';
          mapView.style.display = 'block';

          document.querySelectorAll('.room').forEach(r => r.classList.remove('highlight'));
          const roomEl = document.getElementById(`room-${photo.room}`);
          if (roomEl) roomEl.classList.add('highlight');

          viewedPhotos.add(photo.id);
          img.classList.add('viewed');
        });

        gallery.appendChild(img);
      });
    }

    // マップ画面クリックで戻る
    mapSvg.addEventListener('click', () => {
      mapView.style.display = 'none';
      gallery.style.display = 'grid';
    });

    loadPhotos();
  </script>
</body>
</html>